<div fxLayout="row" fxLayoutAlign="space-between center" class="flex-p">
  <div fxLayout="row">
    <mat-button-toggle-group #controls="matButtonToggleGroup" appearance="legacy">
      <mat-button-toggle value="add" (click)="openRoleDialog(null)">
        <mat-icon>person_add</mat-icon>
      </mat-button-toggle>
      <mat-button-toggle value="search">
        <mat-icon>search</mat-icon>
      </mat-button-toggle>
    </mat-button-toggle-group>
  </div>
  <form class="role-search" [class.show]="controls.value == 'search'">
    <mat-form-field class="role-search-input">
      <input matInput placeholder="Search role by name..." [(ngModel)]="searchText" name="search">
    </mat-form-field>
  </form>
  <div fxLayout="row" fxLayoutAlign="space-between center">
    <mat-button-toggle-group #viewType="matButtonToggleGroup" appearance="legacy">
      <mat-button-toggle value="grid" [checked]="gridView">
        <mat-icon>view_module</mat-icon>
      </mat-button-toggle>
    </mat-button-toggle-group>
  </div>
</div>

<div *ngIf="viewType?.value ? viewType.value === 'grid' : true" fxLayout="row wrap">
  <div *ngFor="let role of roles | UserSearchPipe : searchText | paginate: { itemsPerPage: 6, currentPage: page }"
    fxFlex="100" fxFlex.gt-md="33.3" fxFlex.md="50" class="flex-p">
    <mat-card class="p-0" style="height: 300px;">
      <mat-card-header style="background: #3f51b5; color: white">
        <div class="bg-primary" fxLayout="row" fxLayoutAlign="space-between center">
          <h3 class="role-name">{{role.title}}</h3>
        </div>
      </mat-card-header>
      <perfect-scrollbar style="max-width: 100%; max-height: 300px">
        <div class="role-content" fxLayout="row" fxLayoutAlign="space-around center">
          <div fxFlex="100" *ngIf="selectionView === 'tree'" fxLayout="column" class="role-details transition-2">
            <mat-tree [dataSource]="roleTreeNodes[role.name]?.treeNodes" [treeControl]="treeControl"
              class="example-tree">
              <mat-tree-node *matTreeNodeDef="let role" matTreeNodeToggle>
                <li class="mat-tree-node">
                  <button mat-icon-button disabled></button>
                  {{role.title}}
                </li>
              </mat-tree-node>
              <mat-nested-tree-node *matTreeNodeDef="let node; when: hasChild">
                <li>
                  <div class="mat-tree-node">
                    <button mat-icon-button matTreeNodeToggle [attr.aria-label]="'toggle ' + node.name">
                      <mat-icon class="mat-icon-rtl-mirror">
                        {{treeControl.isExpanded(node) ? 'expand_more' : 'chevron_right'}}
                      </mat-icon>
                    </button>
                    {{node.name}}
                  </div>
                  <ul [class.example-tree-invisible]="!treeControl.isExpanded(node)">
                    <ng-container matTreeNodeOutlet></ng-container>
                  </ul>
                </li>
              </mat-nested-tree-node>
            </mat-tree>
          </div>
          <div fxFlex="100" *ngIf="selectionView === 'list'" fxLayout="column" class="role-details transition-2">
            <mat-list>
              <mat-list-item *ngFor="let item of roleTreeNodes[role.name]">{{item?.name}} [{{item?.route?.link}}]</mat-list-item>
            </mat-list>
          </div>
        </div>
      </perfect-scrollbar>
    </mat-card>
  </div>
</div>

<div *ngIf="viewType?.value ? viewType.value === 'list' : false" fxLayout="row wrap">
  <div *ngFor="let role of roles | UserSearchPipe : searchText | paginate: { itemsPerPage: 6, currentPage: page }"
    fxFlex="100" class="flex-p">
    <mat-card class="p-0">
      <div class="bg-primary" fxLayout="row" fxLayoutAlign="space-between center">
        <h3 class="role-name">{{role.title}}</h3>
        <button [ngStyle]="{'display': role.name === 'admin' || role.name === 'user'? 'none':'block'}" mat-icon-button
          [matMenuTriggerFor]="menu" #menuTrigger="matMenuTrigger">
        </button>
      </div>
      <mat-menu [ngStyle]="{'display': role.name === 'admin' || role.name === 'user'? 'none':'block'}" #menu="matMenu"
        xPosition="before" overlapTrigger="true">
        <span (mouseleave)="menuTrigger.closeMenu()">
          <button mat-menu-item (click)="openRoleDialog(role)">
            <mat-icon>mode_edit</mat-icon>
            <span>Edit</span>
          </button>
          <button mat-menu-item (click)="deleteRole(role);">
            <mat-icon>delete</mat-icon>
            <span>Delete</span>
          </button>
        </span>
      </mat-menu>
      <div class="role-content" fxLayout="row" fxLayoutAlign="space-around center">
        <div fxFlex="100" fxLayout="column" class="role-details transition-2">
          <mat-tree [dataSource]="roleTreeNodes[role.name]?.treeNodes" [treeControl]="treeControl" class="example-tree">
            <mat-tree-node *matTreeNodeDef="let role" matTreeNodeToggle>
              <li class="mat-tree-node">
                <button mat-icon-button disabled></button>
                {{role.name}}
              </li>
            </mat-tree-node>
            <mat-nested-tree-node *matTreeNodeDef="let node; when: hasChild">
              <li>
                <div class="mat-tree-node">
                  <button mat-icon-button matTreeNodeToggle [attr.aria-label]="'toggle ' + node.name">
                    <mat-icon class="mat-icon-rtl-mirror">
                      {{treeControl.isExpanded(node) ? 'expand_more' : 'chevron_right'}}
                    </mat-icon>
                  </button>
                  {{node.name}}
                </div>
                <ul [class.example-tree-invisible]="!treeControl.isExpanded(node)">
                  <ng-container matTreeNodeOutlet></ng-container>
                </ul>
              </li>
            </mat-nested-tree-node>
          </mat-tree>
        </div>
      </div>
    </mat-card>
  </div>
</div>

<div *ngIf="roles" fxLayout="row wrap">
  <div fxFlex="100" class="flex-p">
    <mat-card class="p-0 text-center">
      <pagination-controls class="gradus-pagination" autoHide="true" maxSize="3" (pageChange)="onPageChanged($event)">
      </pagination-controls>
    </mat-card>
  </div>
</div>

<div *ngIf="!roles" fxLayout="column" fxLayoutAlign="center center" class="role-spinner">
  <mat-spinner color="primary"></mat-spinner>
</div>
